<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tan</title>
<style>
:root{--accent:#ed4956;}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f2f2f2;}
.navbar{position:sticky;top:0;width:100%;background:#fff;padding:12px 20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.05);}
.navbar h1{margin:0;font-size:24px;color:#111;}
.upload-btn{padding:8px 16px;background:#111;color:#fff;border:none;border-radius:6px;cursor:pointer;}
.upload-form{display:none;padding:12px;border:1px solid #ccc;border-radius:10px;margin:10px auto;background:#fff;max-width:480px;}
.upload-form input, .upload-form button{box-sizing:border-box;width:100%;padding:8px;margin-bottom:8px;border-radius:6px;border:1px solid #ccc;}
.upload-form button{border:none;background:#111;color:#fff;cursor:pointer;width:auto;}
.container{max-width:980px;margin:0 auto;padding:10px;}
.feed{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;}
.feed-item{position:relative;border-radius:10px;overflow:hidden;background:#fff;cursor:pointer;}
.feed-item img{display:block;width:100%;height:250px;object-fit:cover;}
.heart-wrap{position:absolute;right:8px;bottom:8px;display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.85);padding:4px 8px;border-radius:999px;}
.heart-btn{width:34px;height:34px;border-radius:50%;border:none;background:transparent;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;}
.heart-svg{width:18px;height:18px;transition:transform .2s ease;transform-origin:center;}
.heart-svg.liked{fill:var(--accent);transform:scale(1.2);}
.heart-anim{position:absolute;top:-10px;left:50%;transform:translateX(-50%) scale(0);width:50px;height:50px;pointer-events:none;fill:var(--accent);opacity:0;animation:heartPop 0.6s forwards;}
@keyframes heartPop{0%{transform:translateX(-50%) scale(0);opacity:0;}50%{transform:translateX(-50%) scale(1.2);opacity:1;}100%{transform:translateX(-50%) scale(1);opacity:0;}}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s;z-index:9999;}
.modal.open{opacity:1;pointer-events:auto;}
.modal-content{background:#fff;border-radius:12px;max-width:600px;width:90%;overflow:hidden;position:relative;}
.modal-content img{width:100%;height:auto;display:block;}
.modal-close{position:absolute;top:8px;right:8px;background:#111;color:#fff;border:none;border-radius:50%;width:30px;height:30px;cursor:pointer;font-weight:bold;font-size:18px;}
.modal-info{padding:12px;}
.modal-info .likes{font-weight:bold;margin-bottom:6px;}
.modal-info .desc{color:#333;}
</style>
</head>
<body>

<div class="navbar">
  <h1>Tan</h1>
  <button class="upload-btn" id="showUpload">Upload</button>
</div>

<div class="upload-form" id="uploadForm">
  <input id="photoInput" type="file" accept="image/*">
  <input id="imgDesc" type="text" placeholder="Description (optional)">
  <button id="uploadBtn">Upload</button>
</div>

<div class="container">
  <div id="feed" class="feed"></div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <button class="modal-close" id="modalClose">&times;</button>
    <img id="modalImg" src="">
    <div class="modal-info">
      <div class="likes" id="modalLikes"></div>
      <div class="desc" id="modalDesc"></div>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.16.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.16.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.16.0/firebase-storage-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyA-lNZ4RQS7Xpu2_vzBPCBaBsi_0TlL8dk",
  authDomain: "appp-5f90c.firebaseapp.com",
  projectId: "appp-5f90c",
  storageBucket: "appp-5f90c.appspot.com",
  messagingSenderId: "215310083943",
  appId: "1:215310083943:web:7869ceb90a03567558b1c2",
  measurementId: "G-JJQCFT3PQ9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// Elements
const feedEl = document.getElementById('feed');
const photoInput = document.getElementById('photoInput');
const imgDesc = document.getElementById('imgDesc');
const uploadBtn = document.getElementById('uploadBtn');
const uploadForm = document.getElementById('uploadForm');
const showUpload = document.getElementById('showUpload');
const modal = document.getElementById('modal');
const modalImg = document.getElementById('modalImg');
const modalLikes = document.getElementById('modalLikes');
const modalDesc = document.getElementById('modalDesc');
const modalClose = document.getElementById('modalClose');

// Show/hide upload form
showUpload.addEventListener('click', () => {
  uploadForm.style.display = uploadForm.style.display === 'none' ? 'block' : 'none';
});

// Upload
uploadBtn.addEventListener('click', async () => {
  const file = photoInput.files[0];
  if (!file) { alert("Choose a photo!"); return; }
  const desc = imgDesc.value.trim();
  try {
    const storageRef = storage.ref('images/' + Date.now() + '_' + file.name);
    const snapshot = await storageRef.put(file);
    const url = await snapshot.ref.getDownloadURL();
    await db.collection('posts').add({ url, desc, likes: 0, created: Date.now() });
    photoInput.value = ''; 
    imgDesc.value = ''; 
    uploadForm.style.display = 'none';
  } catch (e) {
    alert("Upload failed: " + e.message);
    console.error(e);
  }
});

// Render single post
function renderPost(item) {
  const wrapper = document.createElement('div'); 
  wrapper.className = 'feed-item';
  wrapper.innerHTML = `<img src="${item.url}">`;
  wrapper.addEventListener('click', () => openModal(item));

  const heartWrap = document.createElement('div'); 
  heartWrap.className = 'heart-wrap';
  heartWrap.innerHTML = `
    <button class="heart-btn">
      <svg class="heart-svg ${item.likes>0?'liked':''}" viewBox="0 0 24 24">
        <path d="M12.1 21.35l-1.1-.99C5.14 15.36 2 12.28 2 8.5 2 6.02 4.02 4 6.5 4c1.74 0 3.41.81 4.5 2.09C12.09 4.81 13.76 4 15.5 4 17.98 4 20 6.02 20 8.5c0 3.78-3.14 6.86-8.9 11.86l-1 1z"/>
      </svg>
      <div class="heart-count">${item.likes}</div>
    `;
  const heartBtn = heartWrap.querySelector('.heart-btn');
  const heartSvg = heartWrap.querySelector('.heart-svg');
  const heartCount = heartWrap.querySelector('.heart-count');
  heartBtn.addEventListener('click', ev => { 
    ev.stopPropagation(); 
    toggleLike(item.id, heartSvg, heartCount); 
  });
  wrapper.appendChild(heartWrap);
  return wrapper;
}

// Realtime Feed
db.collection('posts').orderBy('created', 'desc')
  .onSnapshot(snapshot => {
    feedEl.innerHTML = '';
    snapshot.forEach(docSnap => {
      const item = { id: docSnap.id, ...docSnap.data() };
      feedEl.appendChild(renderPost(item));
    });
  });

// Toggle Like
async function toggleLike(postId, heartSvg, heartCountEl) {
  const postRef = db.collection('posts').doc(postId);
  const docSnap = await postRef.get();
  const data = docSnap.data();
  const liked = !heartSvg.classList.contains('liked');
  await postRef.update({ likes: data.likes + (liked ? 1 : -1) });
  heartSvg.classList.toggle('liked');
  heartCountEl.textContent = data.likes + (liked ? 1 : -1);
  if (liked) {
    const animHeart = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    animHeart.setAttribute("viewBox", "0 0 24 24"); 
    animHeart.classList.add("heart-anim");
    animHeart.innerHTML = '<path d="M12.1 21.35l-1.1-.99C5.14 15.36 2 12.28 2 8.5 2 6.02 4.02 4 6.5 4c1.74 0 3.41.81 4.5 2.09C12.09 4.81 13.76 4 15.5 4 17.98 4 20 6.02 20 8.5c0 3.78-3.14 6.86-8.9 11.86l-1 1z"/>';
    heartSvg.parentNode.appendChild(animHeart);
    setTimeout(() => animHeart.remove(), 600);
  }
}

// Modal
function openModal(item) {
  modalImg.src = item.url;
  modalLikes.textContent = 'Likes: ' + item.likes;
  modalDesc.textContent = item.desc || '';
  modal.classList.add('open');
}
modalClose.addEventListener('click', () => modal.classList.remove('open'));
modal.addEventListener('click', ev => { if (ev.target === modal) modal.classList.remove('open'); });
</script>

</body>
</html>
