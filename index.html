<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Print Snap</title>
  <style>
    body,html {
      margin:0;
      padding:0;
      height:100%;
      background:#000;
      color:#fff;
      font-family:sans-serif;
    }
    #camera-container {
      position:relative;
      width:100%;
      height:80%;
      background:#000;
    }
    video {
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .profile-pic {
      position:absolute;
      top:10px;
      left:10px;
      width:40px;
      height:40px;
      border-radius:50%;
      z-index:10;
    }
    .save-icon {
      position:absolute;
      top:10px;
      right:10px;
      width:30px;
      height:30px;
      z-index:10;
      cursor:pointer;
    }
    .capture-button {
      width:70px;
      height:70px;
      border-radius:50%;
      background:#fff;
      border:none;
      margin:10px auto;
      display:block;
    }
    .bottom-nav {
      position:fixed;
      bottom:0;
      width:100%;
      display:flex;
      justify-content:space-around;
      background:rgba(0,0,0,0.3);
      padding:10px 0;
    }
    .hidden {display:none;}
    #post-options {
      padding:10px;
      background:#111;
    }
    label.stl-button {
      display:inline-block;
      padding:5px 10px;
      background:#444;
      border-radius:5px;
      cursor:pointer;
    }
  </style>
</head>
<body>

  <div id="camera-container">
    <img id="profilePic" class="profile-pic hidden" src="">
    <img src="save.png" class="save-icon" id="saveCapture">
    <video id="camera" autoplay playsinline></video>
  </div>

  <button class="capture-button" id="captureBtn"></button>

  <div id="post-options" class="hidden">
    <input type="text" id="caption" placeholder="Add a caption"><br><br>
    <select id="printerGuess">
      <option>AI guess: Prusa MK3S+</option>
      <option>Ender 3 V2</option>
      <option>Bambu Labs X1C</option>
      <option>Anycubic Kobra</option>
      <option>Other</option>
    </select><br><br>
    <label for="stl-upload" class="stl-button">Upload STL</label>
    <input type="file" id="stl-upload" accept=".stl" style="display:none;"><br><br>
    <button id="postStory">Post to Story</button>
    <button id="postSpotlight">Post to Spotlight</button>
  </div>

  <div class="bottom-nav">
    <button>ðŸ“·</button>
    <button>ðŸ“–</button>
    <button>ðŸŒŸ</button>
  </div>

  <script type="module">
    // Firebase setup
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA-lNZ4RQS7Xpu2_vzBPCBaBsi_0TlL8dk",
      authDomain: "appp-5f90c.firebaseapp.com",
      projectId: "appp-5f90c",
      storageBucket: "appp-5f90c.firebasestorage.app",
      messagingSenderId: "215310083943",
      appId: "1:215310083943:web:7869ceb90a03567558b1c2",
      measurementId: "G-JJQCFT3PQ9"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const provider = new GoogleAuthProvider();

    // sign in on load
    signInWithPopup(auth, provider).catch(console.error);

    onAuthStateChanged(auth, user=>{
      if(user){
        document.getElementById('profilePic').src = user.photoURL;
        document.getElementById('profilePic').classList.remove('hidden');
      }
    });

    // Camera
    const video = document.getElementById('camera');
    navigator.mediaDevices.getUserMedia({ video: true, audio:false })
      .then(stream => { video.srcObject = stream; });

    const captureBtn = document.getElementById('captureBtn');
    const postOptions = document.getElementById('post-options');

    captureBtn.addEventListener('click',()=>{
      // freeze frame as preview
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video,0,0);
      video.classList.add('hidden');
      document.getElementById('camera-container').appendChild(canvas);
      postOptions.classList.remove('hidden');
    });

    // Save captured frame
    document.getElementById('saveCapture').addEventListener('click',()=>{
      // implement save of canvas image or video
      alert('Save clicked (implement saving captured image)');
    });

    // STL upload event
    document.getElementById('stl-upload').addEventListener('change', e=>{
      const file = e.target.files[0];
      if(file){
        alert('Selected STL: '+file.name);
        // upload to Firebase Storage here
      }
    });

    document.getElementById('postStory').addEventListener('click',()=>{
      alert('Post to Story (upload image + caption + STL to backend)');
    });
    document.getElementById('postSpotlight').addEventListener('click',()=>{
      alert('Post to Spotlight (upload image + caption + STL to backend)');
    });
  </script>
</body>
</html>
